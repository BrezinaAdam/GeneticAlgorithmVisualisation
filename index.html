<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">

  <title>AI Visualisation</title>
  <meta name="description" content="GenAlgVis">
  <meta name="author" content="Siemens">

  <link rel="stylesheet" href="css/stylenew.css?v=1.0">

  <script type="text/javascript" src="js/d3.v4.min.js" charset="utf"></script>
  <script type="text/javascript" src="./js/genetic/crossOver.js"></script>
  <script type="text/javascript" src="./js/genetic/genotypBuilder.js"></script>
  <script type="text/javascript" src="./js/genetic/initPopulation.js"></script>
  <script type="text/javascript" src="./js/genetic/mutation.js"></script>
  <script type="text/javascript" src="./js/genetic/selection.js"></script>
  <script type="text/javascript" src="./js/neural/neuron.js"></script>
  <script type="text/javascript" src="./js/neural/neuralNetwork.js"></script>
  <script type="text/javascript" src="./js/neural/dataset.js"></script>
  <script type="text/javascript" src="./js/genetic/geneticAlgoritm.js"></script>
  <script src="./js/neuronVisualisation.js"></script>
</head>

<!-- HEADER -->
<header>
  <h2>Genetic Algorithm Visualisation</h2>
  <div class="w3-bar w3-black">
    <button id="tab" onclick="openCity('London')">Neural network</button>
    <button id="tab" onclick="openCity('Paris')">Genetic algorithm</button>
    <!--<button class="w3-bar-item w3-button" onclick="openCity('Tokyo')">Tokyo</button>-->
  </div>
</header>
<script>

<<<<<<< HEAD
<!-- BODY -->
<body>

  <div id="London" class="w3-container city">

    <table border="1">
      <tr>
        <td rowspan="2">
          <!--graf neuronky-->
          <svg class="lond"></svg>

        </td>
        <td >
          grafik
        </td>
      </tr>
      <tr>
        <td>
          grafiiik
        </td>
      </tr>
    </div>
  </table>

  <script>
  var graph = {
    nodes:[],
    links:[]
  };

  let sizeNN = 12;
  graph.nodes.push({"id": String.fromCharCode('A'.charCodeAt()), "group": 1})
  graph.nodes.push({"id": String.fromCharCode('A'.charCodeAt() + sizeNN-1), "group": 3})
  for(let i = 1; i < sizeNN-1; i++){
    graph.nodes.push({"id": String.fromCharCode('A'.charCodeAt() + i), "group": 2})
    graph.links.push({"id": ('w'+i), "source": String.fromCharCode('A'.charCodeAt()), "target": String.fromCharCode('A'.charCodeAt() + i), "value": Math.random()*3.5+2.5});
    graph.links.push({"id": ('w'+(i+sizeNN-2)),"source": String.fromCharCode('A'.charCodeAt() + i), "target": String.fromCharCode('A'.charCodeAt() + sizeNN-1), "value": Math.random()*3.5+2.5});
  }

  var width = 800;
  var height = 550;
  var svgContainer = d3.select(".lond");
  svgContainer.attr("width", width);
  svgContainer.attr("height", height);

  var circles = svgContainer.selectAll("circle")
  .data(graph.nodes)
  .enter()
  .append("circle")
  .attr("id", function(d){return d.id})
  .attr("cx", function (d) {
    if(d.group === 1){
      return width/2 - width/3;
    }else if(d.group === 2){
      return width/2;
    }
    else {
      return width/2 + width/3;
    }

  })
  .attr("cy", function (d) {
    if(d.id === "A" || d.id === String.fromCharCode('A'.charCodeAt() + sizeNN - 1)){
      return height/2;
    }
    else
    {
      return 5 + (height-40)/(sizeNN-2) * (d.id.charCodeAt()-65);
    }
  })
  .attr("r", function (d) {
    if(d.id === "A"){
      return 15;
    }
    else if(d.id === String.fromCharCode('A'.charCodeAt() + sizeNN - 1))
    {
      return 18;
    }
    else {
      return 12;
    }
  })
  .style("fill", function(d) {
    if(d.id === "A"){
      return "#6497b1";
    }
    else if(d.id === String.fromCharCode('A'.charCodeAt() + sizeNN - 1))
    {
      return "#005b96";
    }
    else {
      return "orange";
    }
  })
  .call(d3.drag()
  .on("start", dragstarted));

  var line = svgContainer.selectAll("line")
  .data(graph.links)
  .enter().append("line")
  .attr("id", function(d){return d.id})
  .attr("x1", function(d){
    let xx1 = d3.selectAll("circle[id='"+d.source+"']").attr("cx");
    let yy1 = d3.selectAll("circle[id='"+d.source+"']").attr("cy");
    let xx2 = d3.selectAll("circle[id='"+d.target+"']").attr("cx");
    let yy2 = d3.selectAll("circle[id='"+d.target+"']").attr("cy");
    let r = parseInt(d3.selectAll("circle[id='"+d.source+"']").attr("r"))+4;
    //let r = 20;

    let k = (xx2-xx1) / (yy2-yy1);
    let newx = Math.sqrt(r*r/(1+1/(k*k)));
    let newy = newx/k;
    return parseInt(d3.selectAll("circle[id='"+d.source+"']").attr("cx"))+newx;

  })
  .attr("y1", function(d){
    let xx1 = d3.selectAll("circle[id='"+d.source+"']").attr("cx");
    let yy1 = d3.selectAll("circle[id='"+d.source+"']").attr("cy");
    let xx2 = d3.selectAll("circle[id='"+d.target+"']").attr("cx");
    let yy2 = d3.selectAll("circle[id='"+d.target+"']").attr("cy");
    let r = parseInt(d3.selectAll("circle[id='"+d.source+"']").attr("r"))+4;
    //let r = 20;

    let k = (xx2-xx1) / (yy2-yy1);
    let newx = Math.sqrt(r*r/(1+1/(k*k)));
    let newy = newx/k;
    return parseInt(d3.selectAll("circle[id='"+d.source+"']").attr("cy"))+newy;
  })
  .attr("x2", function(d){
    let xx1 = d3.selectAll("circle[id='"+d.source+"']").attr("cx");
    let yy1 = d3.selectAll("circle[id='"+d.source+"']").attr("cy");
    let xx2 = d3.selectAll("circle[id='"+d.target+"']").attr("cx");
    let yy2 = d3.selectAll("circle[id='"+d.target+"']").attr("cy");
    let r = parseInt(d3.selectAll("circle[id='"+d.target+"']").attr("r"))+4;
    //let r = 21;

    let k = (xx2-xx1) / (yy2-yy1);
    let newx = Math.sqrt(r*r/(1+1/(k*k)));
    let newy = newx/k;

    return parseInt(d3.selectAll("circle[id='"+d.target+"']").attr("cx")) - newx;
  })
  .attr("y2", function(d){
    let xx1 = d3.selectAll("circle[id='"+d.source+"']").attr("cx");
    let yy1 = d3.selectAll("circle[id='"+d.source+"']").attr("cy");
    let xx2 = d3.selectAll("circle[id='"+d.target+"']").attr("cx");
    let yy2 = d3.selectAll("circle[id='"+d.target+"']").attr("cy");
    let r = parseInt(d3.selectAll("circle[id='"+d.target+"']").attr("r"))+4;
    //let r = 20;

    let k = (xx2-xx1) / (yy2-yy1);
    let newx = Math.sqrt(r*r/(1+1/(k*k)));
    let newy = newx/k;
    return parseInt(d3.selectAll("circle[id='"+d.target+"']").attr("cy")) - newy;
  })
  .attr('stroke-width', function(d) {
    return d.value;
  })
  .call(d3.drag()
  .on("start", dragstarted));

  function dragstarted(d) {
    alert(d.id);
  }

  </script>

=======
var sizeNN = 20;
var stateGA = 0;
>>>>>>> e1ac42cde2386fc37457061a2a631f3ace0b2035

 </script>

<!-- BODY -->
<body>

  <div id="outer">
    <div id="London" class="w3-container city">
      <table>
        <tr>
          <td rowspan="2" style="text-align: right;">
            <!--graf neuronky-->
            <svg class="neuralNetwork"></svg>

          </td>
          <td>

            <!--MILAN<svg width="500" height="300" class="neuralNetworkOutput"></svg>-->
            <svg width="500" height="270" class="neuralNetworkOutput"></svg>
          </td>
        </tr>
        <tr>
          <td>
            <svg width="500" height="270" class="neuralNetworkError"></svg>
          </td>
        </tr>

    </table>
    </div>

    <div id="Paris"  class="w3-container city" style="display:none">
      <table>
        <tr>
          <td rowspan="2">
            <svg width="800" height="610" class="geneticAlgorithm"></svg>
          </td>
          <td >
            <svg class="neuralNetworkmini"></svg>
          </td>
        </tr>
        <tr>
          <td>
            <svg class="totalFitness"></svg>
          </td>
        </tr>

      </table>
    </div>
  </div>

  <script src="./js/neuronOutputVisualisation.js"></script>
  <script src="./js/geneticVisualisation.js"></script>
  <script src="./js/fitnessVisualisation.js"></script>

  <script>
    function openCity(cityName) {
      var i;
      var x = document.getElementsByClassName("city");
      for (i = 0; i < x.length; i++) {
        x[i].style.display = "none";
      }
      document.getElementById(cityName).style.display = "table-cell";
    }

    drawNN(".neuralNetwork", 800, 610);
    //drawNN(".neuralNetworkmini", 380,270);
    drawNN(".neuralNetworkmini", 500,300);

    function acceptModal()
    {
      document.getElementById("myModal").style.display ="none";
      let nn_size = parseInt(document.getElementById("nn_size").value);
      let nn_data = document.getElementById("nn_data").selectedIndex;
      let ga_count = parseInt(document.getElementById("ga_count").value);
      let ga_size = parseInt(document.getElementById("ga_size").value);
      let ga_prob = parseInt(document.getElementById("ga_prob").value);
      let ga_range = parseInt(document.getElementById("ga_range").value);

      sizeNN = nn_size + 2;
      drawNN(".neuralNetwork", 800, 610);
      drawNN(".neuralNetworkmini", 500,300);
      startMagic(nn_size, nn_data, ga_size, ga_prob, ga_range, ga_count);
    }
  </script>

  <div id="myModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="modal-close">&times;</span>
        <h2>Select Neural Network and Genetic Algorithm parameter</h2>
      </div>
      <div class="modal-body">
        <table style="margin-left: auto; margin-right: auto;">
          <tr>
            <td>
              <table>
                <tr><td>Hidden layer size: </td><td><input type="number" id="nn_size" value="20"/></td></tr>
                <tr>
                  <td>Training dataset: </td>
                  <td>
                    <select id="nn_data" style="width: 100%">
                      <option>y = sin(x)</option>
                      <option>y = x^2</option>
                      <option>y = x^3</option>
                      <option>y = exp(-x^2)</option>
                    </select>
                  </td>
                </tr>
                <tr><td>Iterations count: </td><td><input type="number" id="ga_count" value="200"/></td></tr>
              </table>
            </td>
            <td>
              <table>
                <tr><td>Population size: </td><td><input type="number" id="ga_size" value="500"/></td></tr>
                <tr><td>Mutation probability: </td><td><input type="number" id="ga_prob" value="10"/></td></tr>
                <tr><td>Mutation range: </td><td><input type="number" id="ga_range" value="70"/></td></tr>
              </table>
            </td>
          </tr>
        </table>
      </div>
      <div class="modal-footer">
        <button onclick="acceptModal();">Accept</button>
      </div>
    </div>
  </div>

</body>

<!-- FOOTER -->
<footer>
  <div id="footer">
    <button id="start" onclick="document.getElementById('myModal').style.display = 'block';">Start</button>
    <button id="stop" onclick="pauseMagic();">Pause</button>
    <button id="reset" onclick="resetMagic();">Reset</button>
  </div>
</footer>

<script>
  document.getElementById("stop").disabled = true;
  document.getElementById("reset").disabled = true;
  document.getElementsByClassName("modal-close")[0].onclick = function() { document.getElementById("myModal").style.display ="none" };
</script>

</html>
